import{r as e,j as s,b as t}from"./index-PdmQ-drb.js";import{F as r}from"./AuthModel-D64N2yWM.js";import{C as a}from"./check-circle-BaruSI6u.js";import{M as l}from"./mic-BFmq38Yx.js";import{X as n,L as i}from"./x-circle-RL2QsOs-.js";import{E as c}from"./eye-off-ChJyI8bg.js";import{E as o}from"./eye-DPABW9gE.js";import{A as d}from"./arrow-left-Cw3Cw_fQ.js";import"./createLucideIcon-C8aMiAuU.js";const m=({token:m,onSuccess:x,onRequestNewLink:h})=>{const[u,j]=e.useState(""),[p,b]=e.useState(""),[f,N]=e.useState(!1),[w,v]=e.useState(!1),[g,y]=e.useState(null),[k,_]=e.useState(!1),S=e.useMemo(()=>{if(m)return m;return new URLSearchParams(window.location.search).get("token")||""},[m]);e.useEffect(()=>{S||y("Invalid or missing reset token. Please request a new reset link.")},[S]);const q=e.useMemo(()=>({length:u.length>=8,letter:/[a-zA-Z]/.test(u),number:/[0-9]/.test(u)}),[u]),M=e.useMemo(()=>Object.values(q).every(Boolean),[q]),P=e.useMemo(()=>u===p,[u,p]);return k?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:s.jsx("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md p-6",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center mx-auto mb-4",children:s.jsx(a,{className:"w-6 h-6 text-emerald-600"})}),s.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Password updated!"}),s.jsx("p",{className:"text-sm text-gray-600",children:r.reset.success})]})})}):s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:s.jsx("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"text-center mb-6",children:[s.jsx("div",{className:"w-12 h-12 bg-gray-900 rounded-lg flex items-center justify-center mx-auto mb-4",children:s.jsx(l,{className:"w-6 h-6 text-white"})}),s.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:r.reset.title}),s.jsx("p",{className:"text-sm text-gray-600",children:r.reset.subtitle})]}),g&&s.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(n,{className:"w-4 h-4 text-red-500 flex-shrink-0"}),s.jsx("p",{className:"text-sm text-red-700",children:g})]})}),s.jsxs("form",{onSubmit:async e=>{var s,a,l;if(e.preventDefault(),S)if(u)if(p)if(M)if(P){v(!0),y(null);try{const{data:e}=await t.post("https://nodejs.service.callshivai.com/api/v1/auth/reset-password",{token:S,newPassword:u,confirmPassword:u});e.success&&(_(!0),x?setTimeout(()=>{x()},2e3):setTimeout(()=>{window.location.href="/"},2e3))}catch(n){400===(null==(s=n.response)?void 0:s.status)||410===(null==(a=n.response)?void 0:a.status)||404===(null==(l=n.response)?void 0:l.status)?y(r.reset.errors.token_invalid):y(r.reset.errors.server)}finally{v(!1)}}else y(r.reset.errors.mismatch);else q.length?q.letter?q.number||y(r.reset.errors.no_numbers):y(r.reset.errors.no_letters):y(r.reset.errors.too_short);else y(r.reset.errors.confirm_required);else y(r.reset.errors.password_required);else y("Invalid reset token. Please request a new reset link.")},className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"auth-label",children:r.reset.password_label}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:f?"text":"password",value:u,onChange:e=>j(e.target.value),className:"auth-input pr-20 "+(u&&!M?"border-red-500":u&&M?"border-black":""),placeholder:r.reset.password_placeholder,disabled:w,autoFocus:!0}),s.jsx("div",{className:"absolute right-10 top-1/2 transform -translate-y-1/2",children:u&&(M?s.jsx(a,{className:"w-4 h-4 text-emerald-500"}):s.jsx(n,{className:"w-4 h-4 text-red-500"}))}),s.jsx("button",{type:"button",onClick:()=>N(!f),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors",disabled:w,children:f?s.jsx(c,{className:"w-4 h-4"}):s.jsx(o,{className:"w-4 h-4"})})]}),u&&s.jsx("div",{className:"mt-2 space-y-1",children:r.requirements.map(e=>{return t=q[e.id],r=e.label,l=u.length>0&&!q[e.id],s.jsxs("div",{className:"flex items-center space-x-1.5",children:[t?s.jsx(a,{className:"w-3.5 h-3.5 text-emerald-500"}):s.jsx("span",{className:"w-3.5 h-3.5 flex items-center justify-center "+(l?"text-red-500":"text-gray-300"),children:l?s.jsx(n,{className:"w-3.5 h-3.5"}):"â€¢"}),s.jsx("span",{className:"text-xs "+(t?"text-emerald-600":l?"text-red-600":"text-gray-500"),children:r})]},r);var t,r,l})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"auth-label",children:r.reset.confirm_label}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:f?"text":"password",value:p,onChange:e=>b(e.target.value),className:"auth-input pr-10 "+(p&&!P?"border-red-500":p&&P?"border-black":""),placeholder:r.reset.confirm_placeholder,disabled:w}),s.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:p&&(P?s.jsx(a,{className:"w-4 h-4 text-emerald-500"}):s.jsx(n,{className:"w-4 h-4 text-red-500"}))})]}),p&&!P&&s.jsx("p",{className:"auth-error",children:r.reset.errors.mismatch})]}),s.jsx("button",{type:"submit",disabled:w||!u||!p||!M||!P,className:"auth-button auth-button-primary",children:w?s.jsx(i,{className:"w-4 h-4 animate-spin"}):r.reset.submit_button}),s.jsx("div",{className:"space-y-2",children:s.jsxs("button",{type:"button",onClick:()=>window.location.href="/",className:"auth-button auth-button-secondary",disabled:w,children:[s.jsx(d,{className:"w-4 h-4"}),s.jsx("span",{children:r.reset.back_to_signin})]})})]})]})})})};export{m as default};
