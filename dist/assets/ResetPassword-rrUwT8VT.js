import{r as l,j as e,b as M}from"./index-DDzmeMtE.js";import{F as s,M as L,L as R}from"./AuthModel-dfAyXNkR.js";import{C as p}from"./check-circle-BHNzpnMK.js";import{X as b}from"./x-circle-BQsb8fAa.js";import{E as q}from"./eye-off-BrP9UzIA.js";import{E as O}from"./eye-mxqzun-q.js";import{A as I}from"./arrow-left-DbPUk3Gj.js";import"./createLucideIcon-BaGfl599.js";const U=({token:j,onSuccess:w,onRequestNewLink:$})=>{const[t,y]=l.useState(""),[n,P]=l.useState(""),[h,k]=l.useState(!1),[o,N]=l.useState(!1),[g,a]=l.useState(null),[S,_]=l.useState(!1),f=l.useMemo(()=>j||new URLSearchParams(window.location.search).get("token")||"",[j]);l.useEffect(()=>{f||a("Invalid or missing reset token. Please request a new reset link.")},[f]);const i=l.useMemo(()=>({length:t.length>=8,letter:/[a-zA-Z]/.test(t),number:/[0-9]/.test(t)}),[t]),m=l.useMemo(()=>Object.values(i).every(Boolean),[i]),c=l.useMemo(()=>t===n,[t,n]),E=(r,x,d)=>e.jsxs("div",{className:"flex items-center space-x-1.5",children:[r?e.jsx(p,{className:"w-3.5 h-3.5 text-emerald-500"}):e.jsx("span",{className:`w-3.5 h-3.5 flex items-center justify-center ${d?"text-red-500":"text-gray-300"}`,children:d?e.jsx(b,{className:"w-3.5 h-3.5"}):"â€¢"}),e.jsx("span",{className:`text-xs ${r?"text-emerald-600":d?"text-red-600":"text-gray-500"}`,children:x})]},x),C=async r=>{var x,d,v;if(r.preventDefault(),!f){a("Invalid reset token. Please request a new reset link.");return}if(!t){a(s.reset.errors.password_required);return}if(!n){a(s.reset.errors.confirm_required);return}if(!m){i.length?i.letter?i.number||a(s.reset.errors.no_numbers):a(s.reset.errors.no_letters):a(s.reset.errors.too_short);return}if(!c){a(s.reset.errors.mismatch);return}N(!0),a(null);try{const{data:u}=await M.post("https://shivai-com-backend.onrender.com/api/v1/auth/reset-password",{token:f,newPassword:t,confirmPassword:t});u.success&&(_(!0),setTimeout(w?()=>{w()}:()=>{window.location.href="/"},2e3))}catch(u){((x=u.response)==null?void 0:x.status)===400||((d=u.response)==null?void 0:d.status)===410?a(s.reset.errors.token_invalid):((v=u.response)==null?void 0:v.status)===404?a(s.reset.errors.token_invalid):a(s.reset.errors.server)}finally{N(!1)}};return S?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsx("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center mx-auto mb-4",children:e.jsx(p,{className:"w-6 h-6 text-emerald-600"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Password updated!"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.reset.success})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsx("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-900 rounded-lg flex items-center justify-center mx-auto mb-4",children:e.jsx(L,{className:"w-6 h-6 text-white"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:s.reset.title}),e.jsx("p",{className:"text-sm text-gray-600",children:s.reset.subtitle})]}),g&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4 text-red-500 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-red-700",children:g})]})}),e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"auth-label",children:s.reset.password_label}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:h?"text":"password",value:t,onChange:r=>y(r.target.value),className:`auth-input pr-20 ${t&&!m?"border-red-500":t&&m?"border-black":""}`,placeholder:s.reset.password_placeholder,disabled:o,autoFocus:!0}),e.jsx("div",{className:"absolute right-10 top-1/2 transform -translate-y-1/2",children:t&&(m?e.jsx(p,{className:"w-4 h-4 text-emerald-500"}):e.jsx(b,{className:"w-4 h-4 text-red-500"}))}),e.jsx("button",{type:"button",onClick:()=>k(!h),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors",disabled:o,children:h?e.jsx(q,{className:"w-4 h-4"}):e.jsx(O,{className:"w-4 h-4"})})]}),t&&e.jsx("div",{className:"mt-2 space-y-1",children:s.requirements.map(r=>E(i[r.id],r.label,t.length>0&&!i[r.id]))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"auth-label",children:s.reset.confirm_label}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:h?"text":"password",value:n,onChange:r=>P(r.target.value),className:`auth-input pr-10 ${n&&!c?"border-red-500":n&&c?"border-black":""}`,placeholder:s.reset.confirm_placeholder,disabled:o}),e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:n&&(c?e.jsx(p,{className:"w-4 h-4 text-emerald-500"}):e.jsx(b,{className:"w-4 h-4 text-red-500"}))})]}),n&&!c&&e.jsx("p",{className:"auth-error",children:s.reset.errors.mismatch})]}),e.jsx("button",{type:"submit",disabled:o||!t||!n||!m||!c,className:"auth-button auth-button-primary",children:o?e.jsx(R,{className:"w-4 h-4 animate-spin"}):s.reset.submit_button}),e.jsx("div",{className:"space-y-2",children:e.jsxs("button",{type:"button",onClick:()=>window.location.href="/",className:"auth-button auth-button-secondary",disabled:o,children:[e.jsx(I,{className:"w-4 h-4"}),e.jsx("span",{children:s.reset.back_to_signin})]})})]})]})})})};export{U as default};
